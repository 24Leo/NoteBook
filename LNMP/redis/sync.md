主死从上，主恢复过来后需要和从同步。
    * slave 会记住旧 master 的旧 replication ID 和复制偏移量

##同步过程
* 下载redis源码，然后编译两份redis放到不同的目录下，其中一份当作server端口为9000，另一份为客户端端口为8999。
* 当然为了方便追踪，我们可以在编译源代码之前添加一些日志或其他返回值，这样方便跟踪。

我们可以执行slaveof IP:PORT之后，就会发现返回就完事了，但是redis客户端需要和服务器进行复杂的底层交互，这个对用户是透明的，涉及到的命令有ping、psync（以前是sync，现在两者都支持）。
    * 另外同步后，接下来主从也会一直保持通信。这个也是透明的。
        * 因为服务器需要将新命令流发送过来。
    * 主从同步原理：从服务器命令流追赶主服务器的命令流。
        * 主服务器默认维护一个1M大小的repl_backlog，所有的dirty命令都会放到这里面。
    
###从服务器状态机
* 定时调用replicationCron方法
    * 频率可以设置，默认是1s一次
    
    
    
    
    
###主服务器状态机


[return](README.md)
